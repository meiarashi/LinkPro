# LinkPro AI人材マッチングプラットフォーム 開発TODO リスト
更新日: 2025年8月13日（ドラッグ&ドロップ実装・5段階ステータス簡略化）

## 🎯 システム概要（2025年8月13日時点）

### 完成済み基本機能
- **認証・プロフィール管理**: Supabase Auth、ユーザータイプ（client/pro）
- **AI人材プロフィール**: 4つのスキルレベル、AIツール経験、活用実績
- **プロジェクト管理**: 作成、編集、応募、メッセージング
- **自動マッチング**: 55点満点のスコアリング、上位5名への通知
- **AI対話型プロジェクト作成**: Gemini 2.0 Flash による要件分析支援
- **通知システム**: リアルタイム通知、通知センター
- **検索・フィルタ**: プロジェクト一覧、プロフェッショナル一覧
- **カンバンビュー**: ドラッグ&ドロップ対応、プロジェクトステータス管理

### プロジェクトステータス体系（2025年8月13日簡略化）
**5段階のステータス:**
1. `draft`: 下書き
2. `recruiting`: 募集中（公開中・選定中を統合）
3. `executing`: 実行中（契約済み・進行中を統合）
4. `completed`: 完了
5. `cancelled`: キャンセル

**重要な変更点:**
- ステータス遷移制限を撤廃（自由に変更可能）
- ミスしても簡単に修正可能
- 成功トーストを削除（UIのブロックを防止）

### ドラッグ&ドロップ機能（2025年8月13日実装）
**技術スタック:**
- @dnd-kit/core（最新のドラッグ&ドロップライブラリ）
- @dnd-kit/sortable（ソート可能なリスト）
- React 18 & Next.js 14完全対応

**実装済み機能:**
- カンバンビューでのドラッグ&ドロップ
- キーボード操作対応（アクセシビリティ）
- ドラッグオーバーレイ（視覚的フィードバック）
- スムーズなアニメーション
- エラー時の楽観的更新とロールバック

### カードUI改善（2025年8月13日）
**削除した項目:**
- ステータスバッジ（カラムで分かるため不要）
- 重複する募集人数表示

**追加した機能:**
- 新着応募インジケーター（オレンジ色）
- 新着メッセージインジケーター（青色）
- カード右上の通知ドット（視覚的な変化の通知）
- 優先順位付けされたアクションボタン

### データベース構成（2025年8月13日更新）
**アクティブなテーブル（9つ）:**
- `profiles`: ユーザープロフィール
- `projects`: プロジェクト（5段階ステータス対応）
- `applications`: 応募
- `messages`: メッセージ
- `conversations`: 会話スレッド
- `notifications`: 通知
- `matching_scores`: AIマッチングスコア
- `ai_conversations`: AI対話履歴
- `project_templates`: テンプレート（将来実装用）

### マッチングスコア（55点満点）
- レベル適合度: 30点（最重要）
- 経験年数スコア: 15点
- 稼働可能性スコア: 10点

## 📋 実装優先順位（戦略的ロードマップ）

### 🔴 次の実装（1週間）- 即効性重視
#### 1. AI活用事例機能 【最優先】
- [ ] ai_use_casesテーブルの作成
- [ ] 事例登録フォーム（/profile/cases/new）
- [ ] プロフィールでの事例表示
- [ ] 事例一覧ページ（/ai-cases）
- [ ] いいね・ブックマーク機能

**目的**: Pro側の実績アピール強化、クライアント側の参考事例提供

#### 2. 新着通知システムの実装
- [ ] projectNotificationsデータの取得ロジック
- [ ] リアルタイムでの新着カウント更新
- [ ] 既読管理機能
- [ ] 通知設定のカスタマイズ

### 🟡 短期実装（2-4週間）- 成約率向上
#### 1. プロジェクト完了実績システム
- [ ] project_completionsテーブルの再実装
- [ ] 相互評価機能（5段階評価）
- [ ] 実績バッジシステム
- [ ] 完了プロジェクトのショーケース

#### 2. スカウト機能
- [ ] スカウトメッセージ送信機能
- [ ] スカウト専用通知タイプ
- [ ] スカウトテンプレート管理
- [ ] スカウト返信率の表示

#### 3. 予算・期間の自動見積もり
- [ ] 類似案件分析エンドポイント
- [ ] AI（Gemini）による工数予測
- [ ] 相場情報の表示UI
- [ ] 見積もり根拠の可視化

### 🟢 中期実装（1-2ヶ月）- 信頼性構築
#### 1. 評価・レビューシステム
- [ ] プロジェクト完了後の相互評価
- [ ] スキル別評価
- [ ] 公開レビュー機能
- [ ] レビューへの返信

#### 2. スキル検証機能
- [ ] AIツール習熟度テスト
- [ ] ポートフォリオ審査
- [ ] 認定バッジ発行
- [ ] 定期的な再認定

#### 3. 成功事例の可視化
- [ ] プロジェクト完了レポート
- [ ] ROI計算・表示
- [ ] ケーススタディ作成
- [ ] 成功要因分析

### 🔵 長期実装（3ヶ月以降）- 高度な自動化
#### 1. AIによる要件分析強化
- [ ] 曖昧な要件の明確化
- [ ] 技術的実現可能性診断
- [ ] リスク要因の自動検出
- [ ] 代替案の提案

#### 2. 動的マッチング最適化
- [ ] リアルタイムスコア調整
- [ ] 応募状況による推薦変更
- [ ] 成功確率予測
- [ ] A/Bテストによる改善

## ✅ 完了済みタスク一覧

### 2025年8月13日完了（本日）
#### ドラッグ&ドロップ実装
- [x] react-beautiful-dndから@hello-pangea/dndへの移行試行
- [x] @dnd-kitへの完全移行（React 18対応）
- [x] ProjectKanbanDndKit.tsxの作成
- [x] ドラッグオーバーレイの実装
- [x] キーボード操作対応
- [x] "Invariant failed"エラーの解決
- [x] React StrictModeとの互換性確保

#### ステータスシステムの簡略化
- [x] 8段階から5段階への簡略化
- [x] ステータス遷移制限の撤廃
- [x] 成功トーストの削除（UIブロック防止）
- [x] データベーストリガーの簡素化
- [x] マイグレーション作成（20250813_simplify_to_five_statuses.sql）
- [x] マイグレーション作成（20250813_remove_status_transition_restrictions.sql）

#### カードUI改善
- [x] ProjectCardSimple.tsxの作成
- [x] ステータスバッジの削除
- [x] 新着通知インジケーターの追加
- [x] 優先順位付けアクションボタンの実装
- [x] カード情報の整理と簡素化

#### コード品質向上
- [x] CLAUDE.mdの作成（コードレビュープロセス）
- [x] 不要なパッケージの削除（@types/react-beautiful-dnd）
- [x] デバッグログのクリーンアップ
- [x] エラーハンドリングの改善

### 2025年8月12日完了
#### カンバンビュー実装
- [x] プロジェクトステータスの8段階化（後に5段階に簡略化）
- [x] ProjectKanbanコンポーネント作成
- [x] ProjectCardコンポーネント作成
- [x] ステータス遷移の検証ロジック
- [x] サーバー側でのステータス検証
- [x] ロールバック機能の実装
- [x] アクセシビリティ対応（ARIA、キーボード操作）

#### データベース最適化
- [x] 未使用テーブルの削除（ai_skills、saved_searches、project_completions）
- [x] 孤立データのクリーンアップ
- [x] インデックスの最適化
- [x] ビューの更新（新ステータス対応）

#### バグ修正
- [x] プロジェクト作成時の[object Object]エラー修正
- [x] ステータスマッピングの修正（旧→新ステータス）
- [x] 型キャストエラーの修正（UUID vs TEXT）

### それ以前の完了タスク
#### セキュリティ改善
- [x] SECURITY DEFINERビューをSECURITY INVOKERに変更
- [x] RLS（行レベルセキュリティ）の適用
- [x] 環境変数の非nullアサーション削除
- [x] 適切なエラーハンドリング追加

#### パフォーマンス最適化
- [x] N+1問題の修正（複数ページ）
- [x] バッチクエリによる最適化
- [x] クエリ数を85%削減

#### 基本機能の完成
- [x] AI人材プロフィール拡張
- [x] マッチングスコアシステム
- [x] AI対話型プロジェクト作成
- [x] Gemini 2.0 Flash API統合

## 🔧 技術的改善（継続的）

### セキュリティ・基本機能
- [ ] Function Search Path Mutable問題の修正（12関数）
- [ ] Leaked Password Protectionの有効化検討
- [ ] メール認証フローの実装
- [ ] パスワードリセット機能の動作確認
- [ ] セッション管理の強化
- [ ] 2要素認証の実装

### テスト
- [ ] 単体テストの実装（Jest）
- [ ] 統合テストの実装
- [ ] E2Eテストの実装（Playwright/Cypress）
- [ ] テストカバレッジ80%以上

## 🎯 次回セッションの作業

### 最優先: 新着通知システムの実装
1. **バックエンドの実装**
   - 新着応募カウントの取得API
   - 未読メッセージカウントの取得API
   - WebSocketによるリアルタイム更新

2. **フロントエンドの統合**
   - projectNotificationsデータの取得
   - カンバンビューへの組み込み
   - リアルタイム更新の反映

3. **既読管理**
   - 応募の既読フラグ追加
   - メッセージの既読管理改善
   - 通知のクリア機能

### 期待される効果
- 新着情報を見逃さない
- レスポンス速度の向上
- エンゲージメントの増加

## 📊 現在のシステム状況

**データベース**: 9テーブル（最適化済み）
- ステータス: 5段階に簡略化、遷移制限なし
- セキュリティ: 全テーブルでRLS有効
- パフォーマンス: インデックス最適化済み

**UI/UX**: 大幅改善
- ドラッグ&ドロップ: @dnd-kit実装（安定動作）
- カンバンビュー: 使いやすさ重視の設計
- 新着通知: 視覚的インジケーター実装
- アクセシビリティ: キーボード操作対応

**次の重要マイルストーン**: 新着通知システムにより、プラットフォームのリアルタイム性とユーザーエンゲージメントを向上させる